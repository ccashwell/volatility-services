"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VgCodePipelineStack = void 0;
const cdk = require("aws-cdk-lib");
const pipelines_1 = require("aws-cdk-lib/pipelines");
const utils_1 = require("../functions/utils");
const pipeline_app_stage_1 = require("./pipeline-app-stage");
class VgCodePipelineStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const pipeline = new pipelines_1.CodePipeline(this, "Pipeline", {
            pipelineName: "CdkPipeline",
            synth: new pipelines_1.ShellStep("Synth", {
                input: pipelines_1.CodePipelineSource.gitHub("VolatilityGroup/volatility-services", props.gitBranch),
                commands: ["make bootstrap-pipeline"]
            })
        });
        const stageEnv = utils_1.getEnv(this, "stage");
        pipeline.addStage(new pipeline_app_stage_1.VgPipelineAppStage(this, `${stageEnv.awsEnv}VolatilityServicesAppStage`, {
            env: stageEnv,
            platformAccount: stageEnv.stage
        }));
    }
}
exports.VgCodePipelineStack = VgCodePipelineStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29kZXBpcGVsaW5lLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFrQztBQUNsQyxxREFBbUY7QUFFbkYsOENBQTJDO0FBQzNDLDZEQUF5RDtBQU96RCxNQUFhLG1CQUFvQixTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBQ2hELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBK0I7UUFDdkUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFFdkIsTUFBTSxRQUFRLEdBQUcsSUFBSSx3QkFBWSxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDbEQsWUFBWSxFQUFFLGFBQWE7WUFDM0IsS0FBSyxFQUFFLElBQUkscUJBQVMsQ0FBQyxPQUFPLEVBQUU7Z0JBQzVCLEtBQUssRUFBRSw4QkFBa0IsQ0FBQyxNQUFNLENBQUMscUNBQXFDLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQztnQkFDeEYsUUFBUSxFQUFFLENBQUMseUJBQXlCLENBQUM7YUFDdEMsQ0FBQztTQUNILENBQUMsQ0FBQTtRQUVGLE1BQU0sUUFBUSxHQUFHLGNBQU0sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFFdEMsUUFBUSxDQUFDLFFBQVEsQ0FDZixJQUFJLHVDQUFrQixDQUFDLElBQUksRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLDRCQUE0QixFQUFFO1lBQzNFLEdBQUcsRUFBRSxRQUFRO1lBQ2IsZUFBZSxFQUFFLFFBQVEsQ0FBQyxLQUF3QjtTQUNuRCxDQUFDLENBQ0gsQ0FBQTtJQUNILENBQUM7Q0FDRjtBQXJCRCxrREFxQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCJcbmltcG9ydCB7IENvZGVQaXBlbGluZSwgQ29kZVBpcGVsaW5lU291cmNlLCBTaGVsbFN0ZXAgfSBmcm9tIFwiYXdzLWNkay1saWIvcGlwZWxpbmVzXCJcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCJcbmltcG9ydCB7IGdldEVudiB9IGZyb20gXCIuLi9mdW5jdGlvbnMvdXRpbHNcIlxuaW1wb3J0IHsgVmdQaXBlbGluZUFwcFN0YWdlIH0gZnJvbSBcIi4vcGlwZWxpbmUtYXBwLXN0YWdlXCJcbmltcG9ydCB7IFBsYXRmb3JtQWNjb3VudCB9IGZyb20gXCIuL3R5cGVzXCJcblxuZXhwb3J0IGludGVyZmFjZSBWZ0NvZGVQaXBlbGluZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XG4gIGdpdEJyYW5jaDogc3RyaW5nXG59XG5cbmV4cG9ydCBjbGFzcyBWZ0NvZGVQaXBlbGluZVN0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFZnQ29kZVBpcGVsaW5lU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpXG5cbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBDb2RlUGlwZWxpbmUodGhpcywgXCJQaXBlbGluZVwiLCB7XG4gICAgICBwaXBlbGluZU5hbWU6IFwiQ2RrUGlwZWxpbmVcIixcbiAgICAgIHN5bnRoOiBuZXcgU2hlbGxTdGVwKFwiU3ludGhcIiwge1xuICAgICAgICBpbnB1dDogQ29kZVBpcGVsaW5lU291cmNlLmdpdEh1YihcIlZvbGF0aWxpdHlHcm91cC92b2xhdGlsaXR5LXNlcnZpY2VzXCIsIHByb3BzLmdpdEJyYW5jaCksXG4gICAgICAgIGNvbW1hbmRzOiBbXCJtYWtlIGJvb3RzdHJhcC1waXBlbGluZVwiXVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgY29uc3Qgc3RhZ2VFbnYgPSBnZXRFbnYodGhpcywgXCJzdGFnZVwiKVxuXG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoXG4gICAgICBuZXcgVmdQaXBlbGluZUFwcFN0YWdlKHRoaXMsIGAke3N0YWdlRW52LmF3c0Vudn1Wb2xhdGlsaXR5U2VydmljZXNBcHBTdGFnZWAsIHtcbiAgICAgICAgZW52OiBzdGFnZUVudixcbiAgICAgICAgcGxhdGZvcm1BY2NvdW50OiBzdGFnZUVudi5zdGFnZSBhcyBQbGF0Zm9ybUFjY291bnRcbiAgICAgIH0pXG4gICAgKVxuICB9XG59XG4iXX0=